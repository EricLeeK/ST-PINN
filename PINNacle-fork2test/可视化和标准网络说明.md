# ST-PINN 可视化和标准前馈网络实验

## 新增功能

本次更新为 ST-PINN 项目增加了以下功能：

### 1. 标准前馈神经网络实验 (`run_experiment_burgers1d_standard_fnn.py`)

- **目的**: 提供标准前馈神经网络求解1D Burgers方程的对比实验
- **架构**: 使用传统的前馈神经网络（FNN），而非时空分离架构
- **网络结构**: `[2, 64, 64, 64, 64, 1]` (输入: [x, t], 输出: [u])
- **激活函数**: tanh
- **训练参数**: 20000 迭代，Adam优化器，学习率 1e-3

### 2. 可视化工具 (`visualization_utils.py`)

新增的可视化工具提供以下功能：

#### 主要函数: `generate_burgers_heatmaps()`

- **解析解热图**: 从参考数据文件(`burgers_shock.mat`)加载真实解
- **模型解热图**: 使用训练好的PINN模型生成预测解  
- **误差热图**: 计算并可视化绝对误差分布
- **时间切片图**: 显示不同时间点的解对比
- **误差计算**: 计算L2相对误差

#### 输出文件

可视化结果保存在 `runs/{实验名称}/visualizations/` 目录下：
- `heatmap_comparison.png`: 三合一热图（预测解、解析解、误差）
- `time_slices.png`: 时间切片对比图

### 3. 增强的实验脚本

所有实验脚本现在都包含自动可视化功能：

- `run_experiment.py` (多项式时间基)
- `run_experiment_burgers1d_fourier.py` (傅里叶时间基)  
- `run_experiment_burgers1d_standard_fnn.py` (标准前馈网络)

实验完成后会自动：
1. 加载最新的模型检查点
2. 生成可视化图表
3. 报告L2误差和文件路径

## 使用方法

### 运行标准前馈网络实验

```bash
cd PINNacle-fork2test
python run_experiment_burgers1d_standard_fnn.py
```

### 为现有模型生成可视化

```python
from visualization_utils import generate_burgers_heatmaps

# 假设已有训练好的模型
results = generate_burgers_heatmaps(model, 'My_Experiment', device='cpu')
print(f"L2 Error: {results['l2_error']:.6f}")
```

### 单独测试可视化功能

```bash
python test_visualization.py
```

## 实验对比

现在可以对比三种不同的PINN架构：

1. **时空分离 + 多项式时间基** (`run_experiment.py`)
2. **时空分离 + 傅里叶时间基** (`run_experiment_burgers1d_fourier.py`) 
3. **标准前馈神经网络** (`run_experiment_burgers1d_standard_fnn.py`)

每个实验都会生成一致的可视化结果，便于性能比较。

## 技术细节

### 数据格式

- 参考解数据: `data/burgers_shock.mat` (MATLAB格式)
- 参考解维度: x ∈ [-1, 1], t ∈ [0, 0.99]
- 网格大小: 256 × 100

### 模型加载

可视化工具支持DeepXDE标准的模型检查点格式：
```python
checkpoint = {
    'model_state_dict': ...,  # 模型权重
    'optimizer_state_dict': ... # 优化器状态
}
```

### 误差计算

L2相对误差定义为：
```
L2_error = ||U_pred - U_exact||_2 / ||U_exact||_2
```

## 示例输出

运行实验后，终端会显示：

```
>>> 实验完成！
>>> 开始生成可视化图表...
Found checkpoint: runs/Burgers1D_Standard_FNN/0-0/20000.pt
✓ 可视化完成！L2误差: 0.123456
  热图保存路径: runs/Burgers1D_Standard_FNN/visualizations/heatmap_comparison.png
  时间切片图保存路径: runs/Burgers1D_Standard_FNN/visualizations/time_slices.png
>>> 所有任务完成！
```

## 注意事项

1. 确保 `data/burgers_shock.mat` 文件存在
2. 需要安装所有依赖项：`torch`, `deepxde`, `numpy`, `scipy`, `matplotlib`
3. 可视化功能会在模型训练完成后自动运行
4. 生成的图像文件较大，注意存储空间